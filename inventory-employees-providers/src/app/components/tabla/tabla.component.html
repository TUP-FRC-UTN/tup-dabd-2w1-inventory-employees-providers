<!-- tabla.component.html -->

<div class="d-flex justify-content-between align-items-center mb-4">
  <!-- Título de la página -->
  <h1 class="text-center mb-0">Historial de Movimiento de Productos</h1>

  <!-- Botón para abrir el modal -->
<button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#infoModal">
  Info
</button>

<!-- Modal -->
<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalLabel">Información sobre la pantalla</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>
          Esta pantalla te permite consultar los registros de productos, incluyendo su alta y baja.
        </p>
        <p>Puedes realizar las siguientes acciones:</p>
        <ul>
          <li>
            Filtrar los productos por rango de fechas, nombre del producto y otros criterios.
          </li>
          <li>
            Ordenar la tabla por diferentes columnas como producto, fecha, cantidad, proveedor y justificativo.
          </li>
          <li>
            Visualizar la información de cada producto, incluyendo el tipo de movimiento (alta o baja) y su descripción.
          </li>
          <li>
            Utilizar la paginación para navegar entre los resultados si hay muchos productos.
          </li>
        </ul>
        <p>
          Adicionalmente, puedes eliminar los filtros aplicados en cualquier momento y aplicar nuevos filtros para ajustar la búsqueda.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>


</div>

<div  class="card p-4 shadow-sm">
  <!-- Sección: Botones de mostrar/ocultar filtro y generar PDF -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Botón para mostrar u ocultar el filtro de productos -->
    <button
      (click)="toggleFiltro()"
      class="btn btn-outline-secondary filtro-toggle"
    >
      <i
        class="bi"
        [ngClass]="mostrarFiltro ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"
      ></i>
      {{ mostrarFiltro ? " Ocultar Filtro" : " Mostrar Filtro" }}
    </button>

    <!-- Botón Generar PDF y Excel -->
    <div class="d-flex mb-3 align-items-center">
      <!-- Botón Generar PDF -->
      <button class="btn btn-primary ms-auto" (click)="generatePDF()">
        Generar PDF
      </button>

      <!-- Botón Generar Excel -->
      <button class="btn btn-success ms-2" (click)="generateExcel()">
        Generar Excel
      </button>
    </div>
  </div>

  <!-- Sección: Filtro de productos -->
  <div *ngIf="mostrarFiltro" class="mb-3">
    <app-filtro
      [productos]="productosNombres"
      (filtroAplicado)="aplicarFiltro($event)"
      (filtrosEliminados)="resetearFiltros()"
    ></app-filtro>
  </div>

  <!-- Sección: Tabla de productos -->
  <div class="table-responsive mt-4">
    <table class="table table-striped table-hover">
      <thead class="table-light">
        <tr>
          <!-- Columna para ordenar productos por nombre -->
          <th (click)="ordenarPor('product')" style="cursor: pointer">
            Producto
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'product'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
          <!-- Columna para ordenar por tipo de movimiento -->
          <th (click)="ordenarPor('modificationType')" style="cursor: pointer">
            Tipo Movimiento
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'modificationType'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
          <!-- Columna para ordenar por fecha de modificación -->
          <th (click)="ordenarPor('date')" style="cursor: pointer">
            Fecha
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'date'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
          <!-- Columna para ordenar por proveedor -->
          <th (click)="ordenarPor('supplier')" style="cursor: pointer">
            Proveedor
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'supplier'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
          <!-- Columna para ordenar por cantidad -->
          <th (click)="ordenarPor('amount')" style="cursor: pointer">
            Cantidad
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'amount'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
          <!-- Columna para ordenar por justificativo -->
          <th (click)="ordenarPor('description')" style="cursor: pointer">
            Justificativo
            <i
              class="bi"
              [ngClass]="
                columnaOrden === 'description'
                  ? ordenAscendente
                    ? 'bi-caret-up-fill'
                    : 'bi-caret-down-fill'
                  : ''
              "
            ></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <!-- Fila con los productos filtrados y paginados -->
        <tr *ngFor="let producto of paginacionProductos()">
          <td>{{ producto.product }}</td>
          <td>{{ producto.modificationType }}</td>
          <td>{{ producto.date | date : "dd/MM/yyyy" }}</td>
          <td>{{ producto.supplier }}</td>
          <td>{{ producto.amount }}</td>
          <td>{{ producto.description }}</td>
        </tr>
        <!-- Mensaje cuando no hay productos disponibles -->
        <tr *ngIf="productosFiltrados.length === 0">
          <td colspan="6" class="text-center">No se encontraron productos.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Sección: Paginación de la tabla -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <!-- Botón para ir a la página anterior -->
      <li class="page-item" [class.disabled]="paginaActual === 1">
        <a
          class="page-link"
          (click)="cambiarPagina(paginaActual - 1)"
          aria-label="Previous"
        >
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <!-- Generar paginación dinámica según el número total de páginas -->
      <li
        class="page-item"
        *ngFor="let pagina of [].constructor(totalPaginas()); let i = index"
        [class.active]="i + 1 === paginaActual"
      >
        <a class="page-link" (click)="cambiarPagina(i + 1)">{{ i + 1 }}</a>
      </li>
      <!-- Botón para ir a la página siguiente -->
      <li class="page-item" [class.disabled]="paginaActual === totalPaginas()">
        <a
          class="page-link"
          (click)="cambiarPagina(paginaActual + 1)"
          aria-label="Next"
        >
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
</div>
