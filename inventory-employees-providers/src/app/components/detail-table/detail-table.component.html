<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-start">Listado y Eliminación de Productos</h2>
    <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#infoModal">
      Info
    </button>
  </div>

  <!-- Modal de Información -->
  <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="infoModalLabel">Información sobre la Página</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Aquí puedes filtrar los productos, seleccionar los que deseas eliminar y proporcionar un justificativo.
          Utiliza los botones de navegación para desplazarte entre las páginas.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación de Eliminación -->
  <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmación de Eliminación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ¿Está seguro que desea eliminar los productos seleccionados?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" (click)="deleteSelected()" data-bs-dismiss="modal">Eliminar</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección: Campo de Filtro -->
  <div class="mb-4">
    <label for="filter" class="form-label">Filtrar</label>
    <div class="input-group">
      <input
        type="text"
        id="filter"
        class="form-control"
        [(ngModel)]="filterTerm"
        (input)="applyFilter()"
        placeholder="Escribe para filtrar..."
      />
      <button class="btn btn-outline-secondary" (click)="clearFilter()">X</button>
    </div>
  </div>

  <!-- Sección: Checkbox Marcar Todos y Botón Generar PDF -->
  <div class="d-flex mb-3 align-items-center">
    <!-- Checkbox Marcar Todos -->
    <div class="form-check me-auto">
      <input
        type="checkbox"
        class="form-check-input"
        [checked]="allSelected()"
        (change)="toggleSelectAll($event)"
        id="selectAll"
      />
      <label class="form-check-label" for="selectAll">
        {{ allSelected() ? "Desmarcar todos" : "Marcar todos" }}
      </label>
    </div>

    <!-- Botón Generar PDF y Excel -->
    <button class="btn btn-primary ms-auto" (click)="generatePDF()">
      Generar PDF
    </button>
    <button class="btn btn-success ms-2" (click)="generateExcel()">
      Generar Excel
    </button>
  </div>

  <!-- Sección: Tabla de Detalles de Productos -->
  <div class="table-responsive mb-4">
    <table class="table table-striped table-bordered" *ngIf="paginatedDetails.length > 0; else noResults">
      <thead class="table-dark">
        <tr>
          <th scope="col" (click)="sortBy('description')">Descripción</th>
          <th scope="col" (click)="sortBy('supplierName')">Nombre del Proveedor</th>
          <th scope="col" (click)="sortBy('state')">Estado</th>
          <th scope="col" (click)="sortBy('price')" class="text-end">Precio</th>
          <th scope="col" class="text-center">Seleccionar</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let detail of paginatedDetails">
          <td>{{ detail.description }}</td>
          <td>{{ detail.supplierName }}</td>
          <td>{{ detail.state }}</td>
          <td class="text-end">{{ detail.price | currency }}</td>
          <td class="text-center">
            <input
              type="checkbox"
              [checked]="selectedIds.includes(detail.id)"
              (change)="toggleSelection(detail.id)"
            />
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #noResults>
      <div class="alert alert-warning text-center" role="alert">
        No hay coincidencias.
      </div>
    </ng-template>
  </div>

  <!-- Sección: Paginación -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mb-4">
      <li class="page-item" [ngClass]="{ disabled: currentPage === 1 }">
        <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">Anterior</button>
      </li>
      <li class="page-item disabled">
        <span class="page-link">Página {{ currentPage }} de {{ totalPages }}</span>
      </li>
      <li class="page-item" [ngClass]="{ disabled: currentPage === totalPages }">
        <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
      </li>
    </ul>
  </nav>

  <!-- Sección: Campo de Justificativo -->
  <div class="mb-4">
    <label for="justificativo" class="form-label">Justificativo</label>
    <textarea
      id="justificativo"
      class="form-control"
      [(ngModel)]="justificativo"
      rows="3"
      placeholder="Escribe el motivo por el cual se borran los productos seleccionados"
    ></textarea>
  </div>

  <!-- Sección: Botón para Eliminar Seleccionados -->
  <div class="text-end">
    <button
      class="btn btn-danger"
      data-bs-toggle="modal"
      data-bs-target="#confirmDeleteModal"
      [disabled]="selectedIds.length === 0 || justificativo.trim() === ''"
    >
      Eliminar Seleccionados
    </button>
  </div>
</div>
