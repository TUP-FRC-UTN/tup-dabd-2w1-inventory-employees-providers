<section class="py-5">

  <div class="container p-3 border border-2 rounded shadow-lg">

    <!-- Fila de búsqueda, selectores de mes y año con botones a la derecha -->
    <div class="row mb-3">
      <div class="col-md-12 d-flex align-items-center justify-content-between">
        <div class="row w-100 align-items-center">
          <div class="col-md-4 d-flex align-items-center">
            <input type="text" id="searchTerm" [(ngModel)]="searchTerm" (input)="filterData()" placeholder="Buscar"
              class="form-control">
          </div>

          <!-- Selector de Año -->
          <div class="col-md-2 d-flex align-items-center">
            <select id="yearSelect" [(ngModel)]="selectedYear" (change)="filterData()" class="form-control">
              <option value="">Seleccione Año</option>
              <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
            </select>
          </div>

          <!-- Selector de Mes -->
          <div class="col-md-2 d-flex align-items-center">
            <select id="monthSelect" [(ngModel)]="selectedMonth" (change)="filterData()" class="form-control">
              <option value="">Seleccione Mes</option>
              <option *ngFor="let month of months; let i = index" [value]="i + 1">{{ month }}</option>
            </select>
          </div>

          <!-- Botones de filtro, limpiar y exportación (en la misma fila) -->
          <div class="col-md-4 d-flex justify-content-end align-items-center">
            <button class="btn btn-primary me-2" (click)="toggleFilters()">
              <i class="bi bi-funnel-fill"></i>
            </button>
            <button class="btn btn-secondary me-2" (click)="resetFilters()">
              <i class="bi bi-trash"></i>
            </button>
            <button class="btn btn-success me-2" (click)="exportToExcel()">
              <i class="fa-solid fa-file-excel"></i>
            </button>
            <button class="btn btn-danger me-2" (click)="exportToPdf()">
              <i class="fas fa-file-pdf"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fila de selectores adicionales (Tipo de Desempeño y Observaciones) -->
<div class="row mb-3" *ngIf="showFilters"> <!-- Mostrar/ocultar esta fila según el estado de los filtros -->
  <div class="col-md-12 d-flex align-items-center">
    <!-- Selector de Tipo de Desempeño -->
    <div class="col-md-4 d-flex align-items-center me-3"> <!-- Agregada clase me-3 para margen a la derecha -->
      <select id="performanceType" [(ngModel)]="selectedPerformanceType" (change)="filterData()"
        class="form-control">
        <option value="">Seleccione Tipo</option>
        <option *ngFor="let type of performanceTypes" [value]="type">{{ type }}</option>
      </select>
    </div>

    <!-- Selector de Cantidad de Observaciones -->
    <div class="col-md-4 d-flex align-items-center">
      <input type="number" id="observationCount" [(ngModel)]="selectedObservationCount" (input)="filterData()"
        class="form-control" placeholder="Observaciones">
    </div>
  </div>
</div>


    <!-- Modal de Información -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Información sobre la Página</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>En esta página, puedes gestionar el desempeño de empleados del sistema. A continuación, se detallan las
              secciones y funcionalidades disponibles:</p>
            <ul>
              <li><strong>Buscar:</strong> Encuentra empleados por nombre o desempeño utilizando el campo de búsqueda.
              </li>
              <li><strong>Filtros de Año y Mes:</strong> Selecciona un año y mes específicos para filtrar el rendimiento
                de los empleados.</li>
              <li><strong>Tabla de Desempeño:</strong> Visualiza una lista detallada de empleados con información sobre
                su desempeño.</li>
              <li><strong>Registrar Observaciones:</strong> Haz clic en el botón "Registrar observación" para añadir
                comentarios sobre el rendimiento de un empleado.</li>
            </ul>
            <p class="text-danger mt-3"><strong>Nota:</strong> No es posible añadir un desempeño para una fecha en la
              que ya se haya registrado o que se encuentre fuera del rango permitido.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla de datos -->
    <table class="data-table table table-striped">
      <thead>
        <tr>
          <th>Año</th>
          <th>Mes</th>
          <th>Empleado</th>
          <th>Observaciones</th>
          <th>Desempeño</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    
    <div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
      <div class="modal fade" aria-labelledby="infoModalLabel" aria-hidden="true" tabindex="-1" 
           [class.show]="showDetailsModal" 
           [ngStyle]="{'display': showDetailsModal ? 'block' : 'none'}">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Detalles de Llamados de Atención</h5>
              <button type="button" class="btn-close" (click)="closeDetailsModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Tipo</th>
                      <th>Observación</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let detail of selectedEmployeeDetails">
                      <td>{{ detail.dateReal[2] }}/{{ detail.dateReal[1] }}/{{ detail.dateReal[0] }}</td>
                      <td>
                        <span class="tag" [ngClass]="detail.wackeUpTypeEnum.toLowerCase()">
                          {{ detail.wackeUpTypeEnum }}
                        </span>
                      </td>
                      <td>{{ detail.observation }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="selectedEmployeeDetails.length === 0" class="text-center p-3">
                No hay llamados de atención para mostrar en este período.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    

    <!-- Boton + Flotante -->
    <button class="floating-btn btn btn-primary" (click)="openModal()">
      <span class="bi-plus-lg"></span>
    </button>

    <!-- Modal del Formulario -->
    <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()"></div>
    <div class="modal fade" tabindex="-1" [class.show]="showModal"
      [ngStyle]="{'display': showModal ? 'block' : 'none'}">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Llamado de Atención</h5>
            <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- En iep-performancelist.component.html -->
            <app-iep-attention-call (closeModal)="closeModal()"
              (showConfirmationMessage)="handleConfirmationMessage($event)"
              (showErrorMessage)="handleErrorMessage($event)">
            </app-iep-attention-call>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Confirmación -->
    <div class="modal-overlay" *ngIf="showConfirmationModal" (click)="closeConfirmationModal()"></div>
    <div class="modal fade" tabindex="-1" [class.show]="showConfirmationModal"
      [ngStyle]="{'display': showConfirmationModal ? 'block' : 'none'}">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Confirmación</h5>
            <button type="button" class="btn-close" (click)="closeConfirmationModal()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-success" role="alert">
              <i class="bi bi-check-circle me-2"></i>{{ confirmationMessage }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="closeConfirmationModal()">
              <i class="bi bi-check-lg me-2"></i>Aceptar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Error -->
    <div class="modal-overlay" *ngIf="showErrorModal" (click)="closeErrorModal()"></div>
    <div class="modal fade" tabindex="-1" [class.show]="showErrorModal"
      [ngStyle]="{'display': showErrorModal ? 'block' : 'none'}">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-danger">Error</h5>
            <button type="button" class="btn-close" (click)="closeErrorModal()" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-danger" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeErrorModal()">
              <i class="bi bi-x-lg me-2"></i>Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>