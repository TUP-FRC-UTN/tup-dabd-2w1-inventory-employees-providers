<section class="py-5">
  <div class="container p-3 border border-2 rounded shadow-lg">
<div class="row">
  <form class="custom-form" #myForm="ngForm" (ngSubmit)="onSubmit(myForm)">
    <div class="row">

      <div class="col-lg-6 mb-3">
        <div class="row">
            <label for="inputName" class="col-2 col-form-label" 
          >Nombre</label>
            <div class="col-10">
                <input type="text" class="form-control" id="name" name="name" [(ngModel)]="dto.name" #name="ngModel"
                minlength="3" [ngClass]="{
                  'is-invalid': name.invalid && name.touched, 
                  'is-valid': name.valid && name.touched
              }" required>
            </div>
            <div class="error-container">
              @if(name.invalid && name.touched) {
                @if(name.errors?.['minlength']) {
                <div class="text-danger">El nombre del producto debe tener al menos 3 caracteres</div>
                } @else {
                <div class="text-danger">Este campo es requerido</div>
                }
              }
            </div>
        </div>
    </div>


    <div class="col-lg-6 mb-3">
      <div class="row">
          <label class="col-2 col-form-label">Categoría</label>
          <div class="col-10">
            <select class="form-select" id="categories" style="border-radius: 0.25rem;"
            id="category" name="category"  [(ngModel)]="dto.category_id" #category="ngModel" min="1"  [ngClass]="{
               'is-invalid': category.invalid && category.touched, 
               'is-valid': category.valid && category.touched
           }"
               required>
               @if(categories$|async) {
                @for (c of categories; track $index) {
                  <option value="{{ c.id }}">{{ c.category }}</option>
                }
              }@else {
                @if(requestInProgress){
                    <option class="loading" 
                    value="0" selected disabled>Cargando categorías...</option>
                }@else {
                  @if(categoriesError){
                   <option class="text-danger" disabled>Error al cargar categorías</option>
                  }@else {
                    <option class="text-danger" selected disabled>No hay categorías disponibles</option>
                  }
                }
              }
            </select>
          </div>
          <div class="error-container">
            @if(category.invalid && category.touched) {
              <div class="text-danger">Este campo es requerido</div>
            }
          </div>
      </div>
  </div>

  <div class="col-lg-12 mb-3">
    <div class="row">
        <label class="col-2 col-lg-1 col-form-label">Descripción</label>
        <div class="col-10 col-lg-11">
          <textarea class="form-control" 
          placeholder="" id="floatingTextarea" style="height: 150px"  
         
           name="descr" #descr="ngModel"  [ngClass]="{
            'is-invalid': descr.invalid && descr.touched, 
            'is-valid': descr.valid && descr.touched
        }"   [(ngModel)]="dto.description" 
           minlength="5" required></textarea>
           <div class="error-container">
             @if(descr.invalid && descr.touched) {
               @if(descr.errors?.['minlength']) {
                 <div class="text-danger">La descripción del producto debe tener al menos 5 caracteres</div>
               }@else {
                 <div class="text-danger">Este campo es requerido</div>
               }
             }
           </div>
        </div>
    </div>
</div>

<div class="col-lg-6 mb-3">
  <div class="row">
      <div class="col-10 input-group">
      <label class="col-2 col-form-label">Precio Unitario</label>
        <input   type="number" class="form-control text-end" 
        aria-label="Amount" #unit="ngModel" [(ngModel)]="dto.unitPrice"
        name="unit" min="0"  [ngClass]="{
          'is-invalid': unit.invalid && unit.touched, 
          'is-valid': unit.valid && unit.touched
      }" 
        >
        <span class="input-group-text">$</span>
      </div>
      <div class="error-container">
        @if(unit.invalid && unit.touched) {
          <div class="text-danger">El precio unitario debe ser igual o mayor a 0</div>
        }
      </div>
  </div>
</div>

<div class="col-lg-6 mb-3">
  <div class="row">
      <label class="col-2 col-form-label">Estado</label>
      <div class="col-10">
          <select (click)="myForm.invalid"  [ngClass]="{
            'is-invalid': state.invalid && state.touched, 
            'is-valid': state.valid && state.touched
        }" 
          class="form-select"  id="" name="state" #state="ngModel" 
          [(ngModel)]="dto.state_id" [value]="0" required>
            <option value="1">Disponible</option>
            <option value="2">En uso</option>
            <option value="3">En mantenimiento</option>
          </select>
      </div>
      <div class="error-container">
        @if(state.invalid && state.touched) {
          <div class="text-danger">Este campo es requerido</div>
        }
      </div>
  </div>
</div>

<div class="col-lg-6 mb-3">
  <div class="row">
      <label class="col-2 col-form-label">Proveedor</label>
      <div class="col-10">
        <select class="form-select" id="supplier" name="supplier" style="border-radius: 0.25rem;"
          [(ngModel)]="dto.supplier_id" #supplier="ngModel"   [ngClass]="{
            'is-invalid': supplier.invalid && supplier.touched, 
            'is-valid': supplier.valid && supplier.touched
        }" 
          min="1" required>
            @if(providers$|async) {
              @for (p of providers; track $index) {
                <option value="{{ p.id }}">{{ p.name }}</option>
              }
            }@else {
              @if(providersError){
                <option class="text-danger" selected disabled>Error al cargar proveedores</option>
              }@else {
                <option class="loading" value="0" selected disabled>Cargando proveedores...</option>
              }
            }
          </select>
      </div>
      <div class="error-container">
        @if(supplier.invalid && supplier.touched) {
          <div class="text-danger">Este campo es requerido</div>
        }
      </div>
  </div>
</div>



<div class="col-lg-6 mb-3">
  <div class="row">
      <label class="col-2 col-form-label">Stock Inicial</label>
      <div class="col-10">
        <input type="number" name="stock" class="form-control text-end" 
        [(ngModel)]="dto.amount"   [ngClass]="{
          'is-invalid': stock.invalid && stock.touched, 
          'is-valid': stock.valid && stock.touched
      }" 
        id="inputStock" #stock="ngModel"  min="1" required>
      
    </div>
    <div class="error-container">
      @if(stock.invalid && stock.touched) {
        @if (stock.errors?.['min']) {
          <div class="text-danger">La cantidad de stock debe ser mayor a 0</div>
        }@else {
          <div class="text-danger">Este campo es requerido</div>
        }
      }
    </div>
      </div>
  </div>

  
<div class="col-lg-6 mb-3">
  <div class="row">
      <label class="col-2 col-form-label">Stock mín.</label>
      <div class="col-10">
        <input #min="ngModel" min="1" type="number" name="min" 
        [(ngModel)]="dto.minAmountWarning" class="form-control text-end" 
        id="inputMinStock"   [ngClass]="{
          'is-invalid': min.invalid && min.touched, 
          'is-valid': min.valid && min.touched
      }" >
      </div>
      <div class="error-container">
        @if(min.invalid && min.touched) {
          @if (min.errors?.['min']) {
            <div class="text-danger">La cantidad de stock debe ser mayor a 0</div>
          }@else {
            <div class="text-danger">Este campo es requerido</div>
          }
        }
      </div>
      </div>
  </div>

  <div class="mb-4 form-check col-4 ml-2">
    <input type="checkbox" name="reusable" class="form-check-input" id="exampleCheck1" [(ngModel)]="dto.reusable">
    <label class="form-check-label" for="exampleCheck1">Reutilizable</label>
  </div>



</div>





    <div class="mb-3 mt-4 row justify-content-end">
      <div class="col-auto">
        <button [disabled]="!myForm.valid" type="submit" class="btn btn-primary" style="width: 100%;">Registrar</button>
      </div>
    </div>

    
  </form>
</div>
</div>
</section>